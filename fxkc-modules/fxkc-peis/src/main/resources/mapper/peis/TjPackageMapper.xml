<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.fxkc.peis.mapper.TjPackageMapper">

    <select id="queryPackageAndProjectPages" resultType="org.fxkc.peis.domain.vo.PackageAndProjectVo">
        select *
            from (select t.id,
            t.package_name as name,
            t.py_simple_code,
            t.standard_amount,
            t.receivable_amount,
            t.discount,
            t.package_sort as sort,
            '1' as type
            from tj_package t  where t.del_flag='0' and t.status='0'
            union all
            select m.id,
            m.combin_project_name as name,
            m.py_simple_code,
            m.standard_amount,
            m.standard_amount as receivableAmount,
            m.discount,
            m.project_sort as sort,
            '2' as type
            from tj_combination_project m where m.del_flag='0' and m.status='0'
        order by type, sort) temp
        <where>
            <if test='name != null and name != ""'>
                temp.name like CONCAT(CONCAT('%',#{name}),'%')  or
                temp.py_simple_code like CONCAT(CONCAT('%',#{name}),'%')
            </if>
        </where>

    </select>

    <select id="queryProjectByPackageId" resultType="org.fxkc.peis.domain.vo.PackageAndProjectVo">
        select m.id,
               m.combin_project_name as name,
               m.py_simple_code,
               m.standard_amount,
               m.standard_amount as receivableAmount,
               m.discount,
               m.project_sort as sort,
               '2' as type
        from tj_combination_project m
        where m.del_flag = '0'
          and m.status = '0'
          and m.id in (select f.combin_project_id
                       from tj_package_info f
                       where f.del_flag = '0'
                         and f.package_id = #{packageId})
        order by m.project_sort
    </select>

</mapper>

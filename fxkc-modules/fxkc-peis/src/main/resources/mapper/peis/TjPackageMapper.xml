<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.fxkc.peis.mapper.TjPackageMapper">

    <select id="queryPackageAndProjectPages" resultType="org.fxkc.peis.domain.vo.PackageAndProjectVo">
        select *
            from (select t.id,
            t.package_name as name,
            t.py_simple_code,
            t.standard_amount,
            t.receivable_amount,
            t.discount,
            t.package_sort as sort,
            '1' as type,
            null as checkType
            from tj_package t  where t.del_flag='0' and t.status='0'
            union all
            select m.id,
            m.combin_project_name as name,
            m.py_simple_code,
            m.standard_amount,
            m.standard_amount as receivableAmount,
            m.discount,
            m.project_sort as sort,
            '2' as type,
            m.check_type
        from tj_combination_project m where m.del_flag='0' and m.status='0'
        order by type, sort) temp
        <where>
            <if test='name != null and name != ""'>
                temp.name like CONCAT(CONCAT('%',#{name}),'%')  or
                temp.py_simple_code like CONCAT(CONCAT('%',#{name}),'%')
            </if>
        </where>

    </select>

    <select id="queryProjectByPackageId" resultType="org.fxkc.peis.domain.vo.PackageAndProjectVo">
        SELECT t1.id,
               t2.combin_project_name as name,
               t2.py_simple_code,
               t1.standard_amount,
               t1.receivable_amount as receivableAmount,
               t1.discount,
               t2.project_sort as sort,
               '2' as type,
               t2.check_type
        FROM tj_package_info t1
                 left join tj_combination_project t2
                           on t1.combin_project_id = t2.id
        where t1.del_flag = '0'
          and t1.package_id = #{packageId}
        order by t2.project_sort

    </select>

    <select id="queryListByIds" resultType="org.fxkc.peis.domain.vo.TjPackageVo">
        select * from TJ_PACKAGE where ID in
        <foreach collection="packageList" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>

</mapper>
